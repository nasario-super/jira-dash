import{j as e,C as T,a as M,b as A,S as y,c as C,R as S,B as j,l as $,F as Z,E as G,i as H,Z as U,A as _,d as J,T as P}from"./index-55f72780.js";import{r as u}from"./vendor-863865b6.js";import{R as Q,L as ee,C as te,X as se,Y as ae,T as ce,a as R}from"./charts-aa2a58ae.js";import"./utils-f0959f0c.js";const de=({issues:b,sprints:k,timeRange:f})=>{const[h,V]=u.useState([]),[g,N]=u.useState(!1),[p,B]=u.useState("all"),[v,E]=u.useState("all");u.useEffect(()=>{w()},[b,k,f]);const w=async()=>{N(!0);try{const t=await F(b,f);V(t)}catch(t){console.error("Error detecting anomalies:",t)}finally{N(!1)}},F=async(t,r)=>{const i=[],a=L(t,r),n=q(a);i.push(...n);const s=I(a);i.push(...s);const l=K(a);i.push(...l);const c=O(a);return i.push(...c),i.sort((d,o)=>{const m={critical:4,high:3,medium:2,low:1};return m[o.severity]-m[d.severity]})},L=(t,r)=>{const i=new Date,a=r==="week"?7:r==="month"?30:90,n=[];for(let s=a;s>=0;s--){const l=new Date(i.getTime()-s*24*60*60*1e3),c=t.filter(m=>new Date(m.fields.created).toDateString()===l.toDateString()),d=c.filter(m=>m.fields.status.statusCategory.name==="Done"),o=c.filter(m=>m.fields.issuetype.name==="Bug");n.push({date:l.toISOString().split("T")[0],velocity:z(c),completion:c.length>0?d.length/c.length:0,bugRate:c.length>0?o.length/c.length:0,cycleTime:W(c),issueCount:c.length})}return n},q=t=>{const r=[],i=t.map(s=>s.velocity),a=i.reduce((s,l)=>s+l,0)/i.length,n=Math.sqrt(i.reduce((s,l)=>s+Math.pow(l-a,2),0)/i.length);return t.forEach((s,l)=>{if(Math.abs(s.velocity-a)>2*n){const c=(s.velocity-a)/a*100,d=Math.abs(c)>100?"critical":Math.abs(c)>50?"high":Math.abs(c)>25?"medium":"low";r.push({id:`velocity-${l}`,type:s.velocity>a?"spike":"drop",metric:"velocity",severity:d,detectedAt:new Date(s.date),value:s.velocity,expectedValue:a,deviation:c,description:`Velocidade ${s.velocity>a?"aumentou":"diminuiu"} ${Math.abs(c).toFixed(1)}% em relação à média`,context:{mean:a,stdDev:n,index:l},chartData:t.map(o=>({date:o.date,value:o.velocity,expected:a,anomaly:o===s}))})}}),r},I=t=>{const r=[],i=t.map(s=>s.completion),a=i.reduce((s,l)=>s+l,0)/i.length,n=Math.sqrt(i.reduce((s,l)=>s+Math.pow(l-a,2),0)/i.length);return t.forEach((s,l)=>{if(Math.abs(s.completion-a)>2*n){const c=(s.completion-a)/a*100,d=Math.abs(c)>100?"critical":Math.abs(c)>50?"high":Math.abs(c)>25?"medium":"low";r.push({id:`completion-${l}`,type:s.completion>a?"spike":"drop",metric:"completion",severity:d,detectedAt:new Date(s.date),value:s.completion,expectedValue:a,deviation:c,description:`Taxa de conclusão ${s.completion>a?"aumentou":"diminuiu"} ${Math.abs(c).toFixed(1)}% em relação à média`,context:{mean:a,stdDev:n,index:l},chartData:t.map(o=>({date:o.date,value:o.completion,expected:a,anomaly:o===s}))})}}),r},K=t=>{const r=[],i=t.map(s=>s.bugRate),a=i.reduce((s,l)=>s+l,0)/i.length,n=Math.sqrt(i.reduce((s,l)=>s+Math.pow(l-a,2),0)/i.length);return t.forEach((s,l)=>{if(Math.abs(s.bugRate-a)>2*n){const c=(s.bugRate-a)/a*100,d=Math.abs(c)>100?"critical":Math.abs(c)>50?"high":Math.abs(c)>25?"medium":"low";r.push({id:`bug-${l}`,type:s.bugRate>a?"spike":"drop",metric:"bugRate",severity:d,detectedAt:new Date(s.date),value:s.bugRate,expectedValue:a,deviation:c,description:`Taxa de bugs ${s.bugRate>a?"aumentou":"diminuiu"} ${Math.abs(c).toFixed(1)}% em relação à média`,context:{mean:a,stdDev:n,index:l},chartData:t.map(o=>({date:o.date,value:o.bugRate,expected:a,anomaly:o===s}))})}}),r},O=t=>{const r=[],i=t.map(s=>s.cycleTime),a=i.reduce((s,l)=>s+l,0)/i.length,n=Math.sqrt(i.reduce((s,l)=>s+Math.pow(l-a,2),0)/i.length);return t.forEach((s,l)=>{if(Math.abs(s.cycleTime-a)>2*n){const c=(s.cycleTime-a)/a*100,d=Math.abs(c)>100?"critical":Math.abs(c)>50?"high":Math.abs(c)>25?"medium":"low";r.push({id:`cycle-${l}`,type:s.cycleTime>a?"spike":"drop",metric:"cycleTime",severity:d,detectedAt:new Date(s.date),value:s.cycleTime,expectedValue:a,deviation:c,description:`Tempo de ciclo ${s.cycleTime>a?"aumentou":"diminuiu"} ${Math.abs(c).toFixed(1)}% em relação à média`,context:{mean:a,stdDev:n,index:l},chartData:t.map(o=>({date:o.date,value:o.cycleTime,expected:a,anomaly:o===s}))})}}),r},z=t=>t.filter(i=>i.fields.status.statusCategory.name==="Done").reduce((i,a)=>{const n=a.fields.issuetype.name;return i+(n==="Story"?3:n==="Task"?2:n==="Bug"?1:5)},0),W=t=>{const r=t.filter(a=>a.fields.status.statusCategory.name==="Done");return r.length===0?0:r.reduce((a,n)=>{const s=new Date(n.fields.created),l=new Date(n.fields.updated);return a+(l.getTime()-s.getTime())},0)/r.length/(1e3*60*60*24)},X=t=>{switch(t){case"spike":return e.jsx(P,{className:"w-5 h-5 text-red-500"});case"drop":return e.jsx(J,{className:"w-5 h-5 text-blue-500"});case"pattern_break":return e.jsx(_,{className:"w-5 h-5 text-orange-500"});case"outlier":return e.jsx(U,{className:"w-5 h-5 text-purple-500"});default:return e.jsx(H,{className:"w-5 h-5 text-gray-500"})}},Y=t=>{switch(t){case"critical":return"bg-red-100 text-red-800 border-red-200";case"high":return"bg-orange-100 text-orange-800 border-orange-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},D=h.filter(t=>{const r=p==="all"||t.metric===p,i=v==="all"||t.severity===v;return r&&i}),x={total:h.length,critical:h.filter(t=>t.severity==="critical").length,high:h.filter(t=>t.severity==="high").length,medium:h.filter(t=>t.severity==="medium").length,low:h.filter(t=>t.severity==="low").length};return g?e.jsxs(T,{children:[e.jsx(M,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"}),"Detecção de Anomalias"]})}),e.jsx(C,{children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(S,{className:"w-6 h-6 animate-spin mr-2"}),e.jsx("span",{children:"Analisando padrões e detectando anomalias..."})]})})]}):e.jsxs(T,{children:[e.jsxs(M,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"}),"Detecção de Anomalias",e.jsx(j,{variant:"secondary",className:"ml-2",children:x.total})]}),e.jsxs($,{variant:"outline",size:"sm",onClick:w,disabled:g,children:[e.jsx(S,{className:`w-4 h-4 mr-2 ${g?"animate-spin":""}`}),"Reanalisar"]})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-2 mt-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:x.critical}),e.jsx("div",{className:"text-xs text-gray-500",children:"Crítico"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:x.high}),e.jsx("div",{className:"text-xs text-gray-500",children:"Alto"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:x.medium}),e.jsx("div",{className:"text-xs text-gray-500",children:"Médio"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:x.low}),e.jsx("div",{className:"text-xs text-gray-500",children:"Baixo"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:x.total}),e.jsx("div",{className:"text-xs text-gray-500",children:"Total"})]})]})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsxs("select",{value:p,onChange:t=>B(t.target.value),className:"px-3 py-1 border rounded-md text-sm",children:[e.jsx("option",{value:"all",children:"Todas as Métricas"}),e.jsx("option",{value:"velocity",children:"Velocidade"}),e.jsx("option",{value:"completion",children:"Conclusão"}),e.jsx("option",{value:"bugRate",children:"Taxa de Bugs"}),e.jsx("option",{value:"cycleTime",children:"Tempo de Ciclo"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("select",{value:v,onChange:t=>E(t.target.value),className:"px-3 py-1 border rounded-md text-sm",children:[e.jsx("option",{value:"all",children:"Todas as Severidades"}),e.jsx("option",{value:"critical",children:"Crítico"}),e.jsx("option",{value:"high",children:"Alto"}),e.jsx("option",{value:"medium",children:"Médio"}),e.jsx("option",{value:"low",children:"Baixo"})]})})]}),e.jsx("div",{className:"space-y-6",children:D.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(y,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhuma anomalia detectada nos dados atuais."}),e.jsx("p",{className:"text-sm",children:"O sistema está funcionando dentro dos padrões esperados."})]}):D.map(t=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[X(t.type),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Anomalia em ",t.metric]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(j,{className:Y(t.severity),children:t.severity}),e.jsx(j,{variant:"outline",children:t.type}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Desvio: ",t.deviation.toFixed(1),"%"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Valor Atual"}),e.jsx("div",{className:"text-lg font-bold",children:t.value.toFixed(2)}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Esperado: ",t.expectedValue.toFixed(2)]})]})]}),e.jsx("p",{className:"text-gray-700 mb-4",children:t.description}),e.jsx("div",{className:"h-64 mb-4",children:e.jsx(Q,{width:"100%",height:"100%",children:e.jsxs(ee,{data:t.chartData,children:[e.jsx(te,{strokeDasharray:"3 3"}),e.jsx(se,{dataKey:"date",tickFormatter:r=>new Date(r).toLocaleDateString("pt-BR")}),e.jsx(ae,{}),e.jsx(ce,{labelFormatter:r=>new Date(r).toLocaleDateString("pt-BR")}),e.jsx(R,{type:"monotone",dataKey:"value",stroke:"#8884d8",strokeWidth:2,name:"Valor Real"}),e.jsx(R,{type:"monotone",dataKey:"expected",stroke:"#82ca9d",strokeWidth:2,strokeDasharray:"5 5",name:"Valor Esperado"})]})})}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["Detectado em: ",t.detectedAt.toLocaleString("pt-BR")]}),e.jsxs($,{variant:"ghost",size:"sm",onClick:()=>{console.log("🔍 Detalhes da anomalia:",t),alert(`Anomalia: ${t.type}

Métrica: ${t.metric}

Severidade: ${t.severity}

Descrição: ${t.description}

Valor Detectado: ${t.value}

Valor Esperado: ${t.expectedValue}

Desvio: ${t.deviation.toFixed(2)}%`)},children:[e.jsx(G,{className:"w-4 h-4 mr-1"}),"Investigar"]})]})]},t.id))})]})]})};export{de as default};
//# sourceMappingURL=AnomalyDetection-32eba3d0.js.map
